# Android Feature Environment Variables

# Build Arguments
# ===============

# Enable Android SDK installation
INCLUDE_ANDROID=false

# Enable Android development tools (emulator, system images)
INCLUDE_ANDROID_DEV=false

# Android command-line tools version
ANDROID_CMDLINE_TOOLS_VERSION=14742923

# Android API levels to install (comma-separated)
ANDROID_API_LEVELS=34,35

# Android NDK version
ANDROID_NDK_VERSION=29.0.14206865

# Runtime Environment Variables
# =============================

# Android SDK paths
ANDROID_HOME=/opt/android-sdk
ANDROID_SDK_ROOT=/opt/android-sdk

# NDK paths (set after installation)
ANDROID_NDK_HOME=/opt/android-sdk/ndk/29.0.14206865
NDK_HOME=/opt/android-sdk/ndk/29.0.14206865

# Cache directories
ANDROID_SDK_HOME=/cache/android-sdk
ANDROID_AVD_HOME=/cache/android-avd
ANDROID_EMULATOR_HOME=/cache/android-avd

# Emulator settings
ANDROID_EMULATOR_USE_SYSTEM_LIBS=1

# Gradle configuration for Android builds
GRADLE_USER_HOME=/cache/gradle

# Notes
# =====
# - Java is automatically installed when INCLUDE_ANDROID=true
# - SDK licenses are pre-accepted for CI/CD automation
# - Multiple API levels can be specified: ANDROID_API_LEVELS=33,34,35
# - Emulator requires KVM for hardware acceleration (host must support)
# - For CI/CD, use headless emulator: emulator @avd -no-window -no-audio
# - INCLUDE_ANDROID_DEV installs emulator and system images

# =========================================================================
# CRITICAL: ARCHITECTURE REQUIREMENTS
# =========================================================================
#
# Android SDK platform-tools (adb, fastboot) and the Android Emulator are
# x86_64 binaries ONLY. They do NOT work natively on arm64 (Apple Silicon,
# AWS Graviton, etc.).
#
# On arm64 hosts, you will encounter errors like:
#   - "rosetta error: failed to open elf at /lib64/ld-linux-x86-64.so.2"
#   - Exit code 133 when running adb
#   - Emulator fails to start or crashes
#
# RECOMMENDED SOLUTIONS:
#
# Option 1: Build and run an x86_64 container (RECOMMENDED)
# ----------------------------------------------------------
# Use Docker's --platform flag to run an x86_64 container via emulation.
# This works on Apple Silicon Macs with Rosetta 2 and on any host with
# QEMU user-mode emulation installed.
#
#   # Build for x86_64 explicitly
#   docker build --platform linux/amd64 \
#     -f containers/Dockerfile \
#     --build-arg PROJECT_NAME=myproject \
#     --build-arg INCLUDE_ANDROID_DEV=true \
#     --build-arg INCLUDE_KOTLIN_DEV=true \
#     -t myproject:android-dev .
#
#   # Run the x86_64 container
#   docker run --platform linux/amd64 -it --rm \
#     -v "$(pwd):/workspace/project" \
#     myproject:android-dev
#
# Performance notes:
#   - Build times are slower due to emulation (~2-3x)
#   - Runtime performance is acceptable for development
#   - sdkmanager, adb, and emulator all work correctly
#   - Kotlin compiler (kotlinc) runs fine in emulation
#
# Option 2: Use a remote x86_64 development server
# -------------------------------------------------
# Run the container on a native x86_64 host (cloud VM, CI server, etc.)
# and connect via SSH or VS Code Remote Development.
#
#   # On the remote x86_64 host
#   docker run -d --name android-dev \
#     -v android-cache:/cache \
#     -p 5037:5037 \  # ADB port forwarding
#     myproject:android-dev sleep infinity
#
#   # Connect from your local machine
#   ssh -L 5037:localhost:5037 user@remote-host
#
# Option 3: CI/CD only (no local development)
# -------------------------------------------
# Use arm64 containers for code editing and testing, but run Android
# builds and instrumented tests on x86_64 CI runners (GitHub Actions,
# CircleCI, etc.).
#
# WHAT WORKS ON ARM64:
# -------------------
# - Kotlin compiler (kotlinc) - runs on JVM, fully functional
# - Gradle builds - works fine, just can't run emulator tests
# - sdkmanager - works for installing packages
# - aapt, aapt2, apksigner, zipalign - work for APK processing
# - NDK (ndk-build, cmake) - arm64 binaries available
#
# WHAT REQUIRES X86_64:
# --------------------
# - adb (Android Debug Bridge) - x86_64 binary only
# - fastboot - x86_64 binary only
# - Android Emulator - x86_64 only, requires KVM
# - Running instrumented tests on emulator
# - Physical device debugging via USB
#
# =========================================================================
