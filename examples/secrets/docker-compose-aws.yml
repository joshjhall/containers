version: "3.8"

# AWS Secrets Manager Integration Example
#
# This example demonstrates how to configure a container to load secrets from
# AWS Secrets Manager at startup.
#
# Prerequisites:
#   - AWS credentials configured (IAM role, access keys, or AWS CLI config)
#   - Secret created in AWS Secrets Manager
#   - IAM permissions: secretsmanager:GetSecretValue
#
# Usage:
#   export AWS_ACCESS_KEY_ID="your-access-key"
#   export AWS_SECRET_ACCESS_KEY="your-secret-key"
#   docker-compose -f docker-compose-aws.yml up

services:
  app:
    image: ${IMAGE_NAME:-myapp:latest}
    container_name: myapp-aws
    environment:
      # Enable AWS Secrets Manager integration
      AWS_SECRETS_ENABLED: "true"

      # Secret configuration
      AWS_SECRET_NAME: "${AWS_SECRET_NAME:-myapp/production/secrets}"
      AWS_REGION: "${AWS_REGION:-us-east-1}"

      # Optional: Specific version
      # AWS_SECRET_VERSION_ID: "version-id-here"
      # AWS_SECRET_VERSION_STAGE: "AWSCURRENT"

      # Optional: Prefix for environment variables
      AWS_SECRET_PREFIX: "APP_"

      # AWS credentials (if not using IAM role)
      AWS_ACCESS_KEY_ID: "${AWS_ACCESS_KEY_ID}"
      AWS_SECRET_ACCESS_KEY: "${AWS_SECRET_ACCESS_KEY}"

      # Universal loader configuration
      SECRET_LOADER_ENABLED: "true"
      SECRET_LOADER_PRIORITY: "aws"
      SECRET_LOADER_FAIL_ON_ERROR: "true"
    networks:
      - app-network
    command: /bin/bash -c "printenv | grep APP_ && sleep infinity"

networks:
  app-network:
    driver: bridge
