# Prometheus Configuration
#
# This configuration scrapes metrics from containers and the observability stack itself.

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: "dev"
    monitor: "container-observability"

# Alertmanager configuration (optional)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets:
#             - alertmanager:9093

# Load alerting rules
rule_files:
  - "/etc/prometheus/alerts.yml"

scrape_configs:
  # Prometheus self-monitoring
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]

  # Container metrics
  - job_name: "containers"
    static_configs:
      - targets: ["container:9090"]
        labels:
          environment: "dev"
          service: "example-container"

    # Or use Docker service discovery (if running many containers)
    # docker_sd_configs:
    #   - host: unix:///var/run/docker.sock
    # relabel_configs:
    #   - source_labels: [__meta_docker_container_label_com_docker_compose_service]
    #     target_label: service
    #   - source_labels: [__meta_docker_container_name]
    #     target_label: container

    # Or use Kubernetes service discovery
    # kubernetes_sd_configs:
    #   - role: pod
    # relabel_configs:
    #   - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
    #     action: keep
    #     regex: true
    #   - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
    #     action: replace
    #     target_label: __metrics_path__
    #     regex: (.+)
    #   - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]
    #     action: replace
    #     regex: ([^:]+)(?::\d+)?;(\d+)
    #     replacement: $1:$2
    #     target_label: __address__

  # Jaeger metrics
  - job_name: "jaeger"
    static_configs:
      - targets: ["jaeger:14269"]

  # OTel Collector metrics
  - job_name: "otel-collector"
    static_configs:
      - targets: ["otel-collector:8888"]

  # Grafana metrics
  - job_name: "grafana"
    static_configs:
      - targets: ["grafana:3000"]
